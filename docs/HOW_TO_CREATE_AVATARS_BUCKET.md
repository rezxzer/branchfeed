# рЃарЃЮрЃњрЃЮрЃа рЃерЃћрЃЋрЃЦрЃЏрЃюрЃљрЃЌ Avatars Bucket - Step-by-Step

**Status**: Рџа№ИЈ **REQUIRED** - Avatar upload рЃљрЃа рЃўрЃЏрЃБрЃерЃљрЃЋрЃћрЃЉрЃА bucket-рЃўрЃА рЃњрЃљрЃарЃћрЃерЃћ

---

## ­ЪЊЇ рЃАрЃљрЃЊ рЃЋрЃюрЃљрЃ«рЃЮ рЃЊрЃљ рЃарЃЮрЃњрЃЮрЃа рЃерЃћрЃЋрЃЦрЃЏрЃюрЃљ?

### Step 1: рЃњрЃљрЃЊрЃљрЃЊрЃў Storage Рєњ Files Tab-рЃќрЃћ

1. Supabase Dashboard-рЃерЃў рЃњрЃљрЃ«рЃАрЃћрЃюрЃў **Storage** (рЃЏрЃљрЃарЃфрЃ«рЃћрЃюрЃљ рЃЏрЃћрЃюрЃўрЃБрЃерЃў)
2. **рЃљрЃарЃљ Policies tab-рЃќрЃћ!** рЃњрЃљрЃЊрЃљрЃЊрЃў **"Files"** tab-рЃќрЃћ (Policies-рЃўрЃА рЃњрЃЋрЃћрЃарЃЊрЃўрЃЌ)
3. Files tab-рЃќрЃћ рЃБрЃюрЃЊрЃљ рЃюрЃљрЃ«рЃЮ:
   - Buckets list (STORIES, рЃЊрЃљ рЃАрЃ«рЃЋрЃљ buckets рЃЌрЃБ рЃљрЃарЃАрЃћрЃЉрЃЮрЃЉрЃА)
   - "New bucket" рЃдрЃўрЃџрЃљрЃЎрЃў (рЃќрЃћрЃЊрЃљ рЃЏрЃљрЃарЃ»рЃЋрЃћрЃюрЃљ рЃЎрЃБрЃЌрЃ«рЃћрЃерЃў)

### Step 2: рЃЊрЃљрЃљрЃГрЃўрЃарЃћ "New bucket"

1. Files tab-рЃќрЃћ рЃЊрЃљрЃљрЃГрЃўрЃарЃћ **"New bucket"** рЃдрЃўрЃџрЃљрЃЎрЃА (рЃќрЃћрЃЊрЃљ рЃЏрЃљрЃарЃ»рЃЋрЃћрЃюрЃљ рЃЎрЃБрЃЌрЃ«рЃћрЃерЃў)
2. рЃњрЃљрЃўрЃ«рЃАрЃюрЃћрЃЉрЃљ modal window

### Step 3: рЃерЃћрЃўрЃДрЃЋрЃљрЃюрЃћ Bucket-рЃўрЃА рЃЊрЃћрЃбрЃљрЃџрЃћрЃЉрЃў

Modal window-рЃерЃў рЃерЃћрЃўрЃДрЃЋрЃљрЃюрЃћ:

1. **Name**: `avatars` 
   - Рџа№ИЈ **рЃФрЃљрЃџрЃўрЃљрЃю рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃўрЃљ**: рЃќрЃБрЃАрЃбрЃљрЃЊ `avatars` (lowercase, no spaces, no capital letters)
   - рЃћрЃА рЃљрЃарЃўрЃА exact name рЃарЃЮрЃЏрЃћрЃџрЃАрЃљрЃф code рЃћрЃФрЃћрЃЉрЃА

2. **Public bucket**: РюЁ **YES** 
   - Check this checkbox
   - рЃћрЃА рЃљрЃБрЃфрЃўрЃџрЃћрЃЉрЃћрЃџрЃўрЃљ рЃарЃЮрЃЏ avatars рЃўрЃДрЃЮрЃА publicly viewable

3. **File size limit**: 
   - **рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃљрЃфрЃўрЃљ**: `5` MB (avatars-рЃўрЃАрЃЌрЃЋрЃўрЃА рЃАрЃљрЃЎрЃЏрЃљрЃарЃўрЃАрЃўрЃљ)
   - рЃљрЃю рЃЊрЃљрЃбрЃЮрЃЋрЃћ 50MB (default), рЃЌрЃБ рЃњрЃўрЃюрЃЊрЃљ
   - Рџа№ИЈ **рЃерЃћрЃюрЃўрЃерЃЋрЃюрЃљ**: рЃЌрЃБ "Restrict file size" toggle ON-рЃўрЃљ, рЃБрЃюрЃЊрЃљ рЃерЃћрЃўрЃДрЃЋрЃљрЃюрЃЮ рЃарЃўрЃфрЃ«рЃЋрЃў (рЃЏрЃљрЃњ: `5`), dropdown-рЃерЃў рЃљрЃўрЃарЃЕрЃўрЃћ `MB`

4. **Allowed MIME types**: 
   - **рЃЋрЃљрЃарЃўрЃљрЃюрЃбрЃў 1**: рЃерЃћрЃўрЃДрЃЋрЃљрЃюрЃћ `image/*` (рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃћрЃА, **рЃљрЃарЃљ** "(optional)" рЃљрЃю рЃАрЃ«рЃЋрЃљ рЃбрЃћрЃЦрЃАрЃбрЃў!)
   - **рЃЋрЃљрЃарЃўрЃљрЃюрЃбрЃў 2**: рЃљрЃю рЃЊрЃљрЃбрЃЮрЃЋрЃћ рЃфрЃљрЃарЃўрЃћрЃџрЃў (рЃЌрЃБ рЃДрЃЋрЃћрЃџрЃљ рЃбрЃўрЃърЃўрЃА рЃцрЃљрЃўрЃџрЃў рЃњрЃўрЃюрЃЊрЃљ)
   - Рџа№ИЈ **рЃерЃћрЃюрЃўрЃерЃЋрЃюрЃљ**: рЃЌрЃБ "Restrict MIME types" toggle ON-рЃўрЃљ, рЃБрЃюрЃЊрЃљ рЃерЃћрЃўрЃДрЃЋрЃљрЃюрЃЮ valid MIME type (рЃЏрЃљрЃњ: `image/*`), **рЃљрЃарЃљ** "(optional)" рЃљрЃю рЃАрЃ«рЃЋрЃљ рЃбрЃћрЃЦрЃАрЃбрЃў!

5. рЃЊрЃљрЃљрЃГрЃўрЃарЃћ **"Create bucket"** рЃдрЃўрЃџрЃљрЃЎрЃА

### Step 4: Verify Bucket Created

1. Files tab-рЃќрЃћ рЃБрЃюрЃЊрЃљ рЃюрЃљрЃ«рЃЮ `avatars` bucket-рЃў bucket list-рЃерЃў
2. рЃБрЃюрЃЊрЃљ рЃўрЃДрЃЮрЃА рЃЏрЃЮрЃюрЃўрЃерЃюрЃБрЃџрЃў рЃарЃЮрЃњрЃЮрЃарЃф **"Public"** (green badge)
3. Policies tab-рЃќрЃћ рЃњрЃљрЃЊрЃљрЃАрЃЋрЃџрЃўрЃАрЃљрЃА рЃБрЃюрЃЊрЃљ рЃюрЃљрЃ«рЃЮ `avatars` bucket-рЃўрЃА policies:
   - "Public read access for avatars" (SELECT)
   - "Authenticated upload avatars" (INSERT)
   - "Users can update own avatars" (UPDATE)
   - "Users can delete own avatars" (DELETE)

---

## ­Ъј» Visual Guide

```
Supabase Dashboard
РћюРћђРћђ Storage (рЃЏрЃљрЃарЃфрЃ«рЃћрЃюрЃљ рЃЏрЃћрЃюрЃўрЃБ)
    РћюРћђРћђ Files Рєљ рЃљрЃЦ рЃБрЃюрЃЊрЃљ рЃўрЃДрЃЮ!
    Рћѓ   РћюРћђРћђ Buckets list
    Рћѓ   Рћѓ   РћюРћђРћђ STORIES
    Рћѓ   Рћѓ   РћћРћђРћђ avatars Рєљ рЃљрЃЦ рЃБрЃюрЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃЕрЃюрЃЊрЃћрЃА рЃерЃћрЃЦрЃЏрЃюрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ
    Рћѓ   РћћРћђРћђ [New bucket] Рєљ рЃљрЃЦ рЃЊрЃљрЃљрЃГрЃўрЃарЃћ!
    Рћѓ
    РћћРћђРћђ Policies Рєљ рЃљрЃЦ рЃљрЃарЃљ! (рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ policies-рЃћрЃЉрЃўрЃА рЃюрЃљрЃ«рЃЋрЃљ)
        РћћРћђРћђ Buckets section
            РћћРћђРћђ avatars Рєљ рЃљрЃЦ рЃњрЃљрЃЏрЃЮрЃЕрЃюрЃЊрЃћрЃЉрЃљ bucket-рЃўрЃА рЃерЃћрЃЦрЃЏрЃюрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ
```

---

## РюЁ Test After Creation

1. рЃњрЃљрЃ«рЃАрЃћрЃюрЃў `/settings` page-рЃќрЃћ
2. рЃЊрЃљрЃљрЃГрЃўрЃарЃћ **"Change Avatar"** рЃдрЃўрЃџрЃљрЃЎрЃА
3. рЃљрЃўрЃарЃЕрЃўрЃћ image file (max 5MB)
4. рЃЊрЃљрЃљрЃГрЃўрЃарЃћ **"Save Changes"**
5. рЃБрЃюрЃЊрЃљ рЃўрЃЏрЃБрЃерЃљрЃЮрЃА! (no error message)

---

## ­ЪљЏ Troubleshooting

### Problem: "New bucket" рЃдрЃўрЃџрЃљрЃЎрЃў рЃљрЃа рЃЕрЃљрЃюрЃА

**Solution**: 
- рЃЊрЃљрЃарЃгрЃЏрЃБрЃюрЃЊрЃў рЃарЃЮрЃЏ Files tab-рЃќрЃћ рЃ«рЃљрЃа, рЃљрЃарЃљ Policies-рЃќрЃћ
- рЃЌрЃБ Files tab-рЃќрЃћ рЃљрЃа рЃЕрЃљрЃюрЃА, refresh page

### Problem: Bucket рЃерЃћрЃЦрЃЏрЃюрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ error-рЃўрЃљ

**Solution**:
- рЃЊрЃљрЃарЃгрЃЏрЃБрЃюрЃЊрЃў рЃарЃЮрЃЏ name рЃљрЃарЃўрЃА exactly `avatars` (lowercase)
- рЃЊрЃљрЃарЃгрЃЏрЃБрЃюрЃЊрЃў рЃарЃЮрЃЏ Public bucket checkbox checked-рЃўрЃљ

### Problem: Policies рЃљрЃа рЃЕрЃљрЃюрЃА Policies tab-рЃќрЃћ

**Solution**:
- Migration рЃБрЃЎрЃЋрЃћ рЃњрЃљрЃерЃЋрЃћрЃЉрЃБрЃџрЃўрЃљ, рЃљрЃАрЃћ рЃарЃЮрЃЏ policies рЃБрЃюрЃЊрЃљ рЃўрЃДрЃЮрЃА
- рЃЌрЃБ рЃљрЃа рЃЕрЃљрЃюрЃА, refresh page
- рЃљрЃю рЃњрЃљрЃБрЃерЃЋрЃў migration рЃЎрЃўрЃЊрЃћрЃЋ рЃћрЃарЃЌрЃ«рЃћрЃџ: `supabase/migrations/20250115_04_add_avatars_bucket_and_policies.sql`

---

**Last Updated**: 2025-01-15

